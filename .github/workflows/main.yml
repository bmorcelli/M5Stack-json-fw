name: Check JSON Files

on:
  workflow_dispatch:
  schedule:
  - cron: "*/15 * * * *"

jobs:
  compare-json:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
    - name: Run Python script
      run: python ./script/update_json.py
      
    - name: Set up Git
      run: |
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git config user.name "github-actions[bot]"
        
    - name: Compare JSON files
      id: compare
      run: |
        if ! cmp -s ./cardputer.json ./script/cardputer.json || ! cmp -s ./stickc.json ./script/stickc.json || cmp -s ./core2.json './script/core2 & tough.json'; then
          echo "Files are different. Updating..."
          rm -f ./cardputer.json ./stickc.json ./core2.json
          cp ./script/cardputer.json ./script/stickc.json ./
          cp './script/core2 & tough.json' ./core2.json
          rm -f ./test/cardputer.json
          cp ./script/cardputer.json ./test/
          git add .
          git commit -m "Update JSON files"
          git push
        else
          echo "Files are the same. Workflow terminated."
        fi
